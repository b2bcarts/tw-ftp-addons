<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- FTP File Form View -->
        <record id="ftp_file_view_form" model="ir.ui.view">
            <field name="name">ftp.file.form</field>
            <field name="model">ftp.file</field>
            <field name="arch" type="xml">
                <form string="FTP File">
                    <header>
                        <button name="view_content" type="object" string="View Content" 
                                class="btn-primary" icon="fa-eye"/>
                        <button name="process_to_sale_orders" type="object" string="Create Sale Orders" 
                                class="btn-success" icon="fa-shopping-cart"/>
                        <button name="reprocess_file" type="object" string="Reprocess" 
                                class="btn-secondary" icon="fa-refresh"/>
                        <field name="status" widget="statusbar" 
                               statusbar_visible="downloaded,processed,moved"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group name="file_info" string="File Information">
                                <field name="ftp_config_id"/>
                                <field name="file_size"/>
                                <field name="processed_date"/>
                                <field name="original_path"/>
                                <field name="moved_path"/>
                            </group>
                            <group name="content_info" string="Content Information">
                                <field name="row_count"/>
                                <field name="column_count"/>
                                <field name="sheet_names"/>
                                <field name="sale_orders_created"/>
                            </group>
                        </group>
                        <group name="error" string="Error Information" attrs="{'invisible': [('status', '!=', 'error')]}">
                            <field name="error_message" nolabel="1"/>
                        </group>
                        <notebook>
                            <page name="content" string="File Content">
                                <field name="content_json" widget="ace" options="{'mode': 'json'}" nolabel="1"/>
                            </page>
                            <page name="processing_log" string="Processing Log">
                                <field name="processing_log" widget="text" nolabel="1" readonly="1"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- FTP File Content View (Popup) -->
        <record id="ftp_file_content_view" model="ir.ui.view">
            <field name="name">ftp.file.content</field>
            <field name="model">ftp.file</field>
            <field name="arch" type="xml">
                <form string="File Content">
                    <sheet>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="row_count" readonly="1"/>
                            <field name="column_count" readonly="1"/>
                            <field name="sheet_names" readonly="1"/>
                        </group>
                        <field name="content_json" widget="ace" options="{'mode': 'json'}" nolabel="1" readonly="1"/>
                    </sheet>
                    <footer>
                        <button string="Close" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- FTP File Tree View -->
        <record id="ftp_file_view_tree" model="ir.ui.view">
            <field name="name">ftp.file.tree</field>
            <field name="model">ftp.file</field>
            <field name="arch" type="xml">
                <tree string="Processed Files">
                    <field name="name"/>
                    <field name="ftp_config_id"/>
                    <field name="file_size"/>
                    <field name="row_count"/>
                    <field name="column_count"/>
                    <field name="processed_date"/>
                    <field name="sale_orders_created"/>
                    <field name="status" widget="badge" 
                           decoration-info="status == 'downloaded'"
                           decoration-success="status in ('processed', 'moved')"
                           decoration-danger="status == 'error'"/>
                    <button name="view_content" type="object" string="View" 
                            icon="fa-eye" class="btn-link"/>
                    <button name="process_to_sale_orders" type="object" string="Create Orders" 
                            icon="fa-shopping-cart" class="btn-link"/>
                    <button name="reprocess_file" type="object" string="Reprocess" 
                            icon="fa-refresh" class="btn-link"
                            attrs="{'invisible': [('status', '=', 'error')]}"/>
                </tree>
            </field>
        </record>

        <!-- FTP File Search View -->
        <record id="ftp_file_view_search" model="ir.ui.view">
            <field name="name">ftp.file.search</field>
            <field name="model">ftp.file</field>
            <field name="arch" type="xml">
                <search string="Processed Files">
                    <field name="name"/>
                    <field name="ftp_config_id"/>
                    <filter name="processed" string="Processed" domain="[('status', '=', 'processed')]"/>
                    <filter name="moved" string="Moved" domain="[('status', '=', 'moved')]"/>
                    <filter name="error" string="Error" domain="[('status', '=', 'error')]"/>
                    <filter name="today" string="Today" domain="[('processed_date', '&gt;=', (context_today()).strftime('%Y-%m-%d'))]"/>
                    <filter name="this_week" string="This Week" domain="[('processed_date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_config" string="FTP Configuration" context="{'group_by': 'ftp_config_id'}"/>
                        <filter name="group_by_status" string="Status" context="{'group_by': 'status'}"/>
                        <filter name="group_by_date" string="Date" context="{'group_by': 'processed_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- FTP File Action -->
        <record id="ftp_file_action" model="ir.actions.act_window">
            <field name="name">Processed Files</field>
            <field name="res_model">ftp.file</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No files processed yet!
                </p>
                <p>
                    Files downloaded and processed from FTP servers will appear here.
                </p>
            </field>
        </record>
    </data>
</odoo>